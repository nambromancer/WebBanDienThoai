@model WebBanDienThoai.Models.Customer

@{
    ViewBag.Title = "Chi tiết khách hàng";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<h2 class="bg-info" style="padding: 15px; color: white; border-radius: 5px;">
    <i class="fas fa-user-circle"></i> CHI TIẾT KHÁCH HÀNG
</h2>

<div class="container-fluid">
    @* Thông tin cơ bản *@
    <div class="card mb-4">
        <div class="card-header bg-light">
            <h4 class="mb-0"><i class="fas fa-info-circle"></i> Thông tin cơ bản</h4>
        </div>
        <div class="card-body">
            @Html.Partial("PartialView_CustomerInfo", Model)
        </div>
    </div>

    @* Lịch sử đơn hàng *@
    <div class="card mb-4">
        <div class="card-header bg-light">
            <h4 class="mb-0">
                <i class="fas fa-shopping-cart"></i> Lịch sử đơn hàng
                @if (Model.Orders != null && Model.Orders.Any())
                {
                    <span class="badge badge-primary float-right">@Model.Orders.Count đơn hàng</span>
                }
            </h4>
        </div>
        <div class="card-body">
            @if (Model.Orders != null && Model.Orders.Any())
            {
                <div class="table-responsive">
                    <table class="table table-striped table-bordered">
                        <thead class="thead-dark">
                            <tr>
                                <th>Mã đơn hàng</th>
                                <th>Ngày đặt</th>
                                <th>Tổng tiền</th>
                                <th>Trạng thái</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var order in Model.Orders.OrderByDescending(o => o.OrderID))
                            {
                                <tr>
                                    <td><strong>#@order.OrderID</strong></td>
                                    <td>
                                        @if (order.OrderDate.HasValue)
                                        {
                                            @order.OrderDate.Value.ToString("dd/MM/yyyy HH:mm")
                                        }
                                        else
                                        {
                                            <span class="text-muted">N/A</span>
                                        }
                                    </td>
                                    <td>
                                        <strong class="text-success">@String.Format("{0:N0} ₫", order.TotalAmount)</strong>
                                    </td>
                                    <td>
                                        @if (!string.IsNullOrWhiteSpace(order.OrderStatus))
                                        {
                                            switch (order.OrderStatus.ToLower())
                                            {
                                                case "pending":
                                                case "chờ xử lý":
                                                    <span class="badge badge-warning">Chờ xử lý</span>
                                                    break;
                                                case "processing":
                                                case "đang xử lý":
                                                    <span class="badge badge-info">Đang xử lý</span>
                                                    break;
                                                case "shipped":
                                                case "đã gửi":
                                                    <span class="badge badge-primary">Đã gửi</span>
                                                    break;
                                                case "delivered":
                                                case "đã giao":
                                                    <span class="badge badge-success">Đã giao</span>
                                                    break;
                                                case "cancelled":
                                                case "đã hủy":
                                                    <span class="badge badge-danger">Đã hủy</span>
                                                    break;
                                                default:
                                                    <span class="badge badge-secondary">@order.OrderStatus</span>
                                                    break;
                                            }
                                        }
                                        else
                                        {
                                            <span class="text-muted">N/A</span>
                                        }
                                    </td>
                                    <td>
                                        @Html.ActionLink("Xem chi tiết", "Details", "Orders", new { area = "Admin", id = order.OrderID }, new { @class = "btn btn-sm btn-info" })
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                @* Thống kê đơn hàng *@
                <div class="row mt-3">
                    <div class="col-md-12">
                        <div class="alert alert-success">
                            <strong><i class="fas fa-chart-line"></i> Thống kê:</strong>
                            <ul class="mb-0">
                                <li>Tổng số đơn hàng: <strong>@Model.Orders.Count</strong></li>
                                <li>
                                    Tổng giá trị đơn hàng:
                                    <strong class="text-success">
                                        @String.Format("{0:N0} ₫", Model.Orders.Sum(o => o.TotalAmount))
                                    </strong>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            }
            else
            {
                <div class="alert alert-info mb-0">
                    <i class="fas fa-info-circle"></i>
                    Khách hàng chưa có đơn hàng nào.
                </div>
            }
        </div>
    </div>
</div>

<div class="form-group mt-4">
    <div class="col-md-offset-3 col-md-9">
        @Html.ActionLink("Chỉnh sửa", "Edit", new { id = Model.CustomerID }, new { @class = "btn btn-warning" })
        @Html.ActionLink("Xóa", "Delete", new { id = Model.CustomerID }, new { @class = "btn btn-danger" })
        @Html.ActionLink("Quay lại danh sách", "Index", null, new { @class = "btn btn-secondary" })
    </div>
</div>