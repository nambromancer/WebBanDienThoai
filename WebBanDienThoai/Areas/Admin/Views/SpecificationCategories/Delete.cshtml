@model WebBanDienThoai.Models.SpecificationCategory

@{
    ViewBag.Title = "Delete";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<h2 class="bg-danger text-white">XÓA DANH MỤC THÔNG SỐ</h2>

<div class="alert alert-danger" role="alert">
    <i class="fas fa-exclamation-triangle"></i>
    <strong>Cảnh báo!</strong> Bạn có chắc chắn muốn xóa danh mục thông số này?
</div>

<div>
    <hr />
    <div class="row mb-3">
        <label class="col-md-2 col-form-label">Danh mục sản phẩm</label>
        <div class="col-md-10 pt-2">
            @if (Model.Category != null)
            {
                <span class="badge bg-primary" style="font-size: 14px;">@Model.Category.CategoryName</span>
            }
            else
            {
                <span class="badge bg-secondary">Chưa gán danh mục</span>
            }
        </div>
    </div>

    <div class="row mb-3">
        <label class="col-md-2 col-form-label">Icon</label>
        <div class="col-md-10 pt-2">
            @if (!string.IsNullOrWhiteSpace(Model.SpecCategoryIcon))
            {
                <i class="@Model.SpecCategoryIcon" style="font-size: 24px;"></i>
                <span>@Model.SpecCategoryIcon</span>
            }
            else
            {
                <text>Không có</text>
            }
        </div>
    </div>

    <div class="row mb-3">
        <label class="col-md-2 col-form-label">Tên danh mục thông số</label>
        <div class="col-md-10 pt-2">
            @Html.DisplayFor(m => m.SpecCategoryName)
        </div>
    </div>

    <div class="row mb-3">
        <label class="col-md-2 col-form-label">Thứ tự hiển thị</label>
        <div class="col-md-10 pt-2">
            @{
                var displayOrderText = Model.DisplayOrder.HasValue ? Model.DisplayOrder.Value.ToString() : "Không xác định";
            }
            @displayOrderText
        </div>
    </div>

    <div class="row mb-3">
        <label class="col-md-2 col-form-label">Danh sách tên thông số mẫu</label>
        <div class="col-md-10 pt-2">
            @{
                var templateSpecs = Model.ProductSpecifications != null
                    ? Model.ProductSpecifications.Where(ps => ps.ProductID == 0).ToList()
                    : new List<WebBanDienThoai.Models.ProductSpecification>();
            }
            @if (templateSpecs != null && templateSpecs.Any())
            {
                <div class="alert alert-warning">
                    <i class="fas fa-info-circle"></i>
                    <strong>Lưu ý:</strong> Xóa danh mục này sẽ xóa luôn <strong>@templateSpecs.Count</strong> tên thông số mẫu sau:
                </div>
                <div class="list-group">
                    @foreach (var spec in templateSpecs.OrderBy(s => s.DisplayOrder ?? int.MaxValue).ThenBy(s => s.SpecName))
                    {
                        <div class="list-group-item">
                            <i class="fas fa-tag text-danger"></i>
                            <strong>@spec.SpecName</strong>
                        </div>
                    }
                </div>
            }
            else
            {
                <span class="badge bg-secondary" style="font-size: 14px;">Không có tên thông số mẫu</span>
            }
        </div>
    </div>

    <div class="row mb-3">
        <label class="col-md-2 col-form-label">Số lượng thông số đã sử dụng</label>
        <div class="col-md-10 pt-2">
            @{
                var usedSpecs = Model.ProductSpecifications != null
                    ? Model.ProductSpecifications.Where(ps => ps.ProductID != 0).Count()
                    : 0;
            }
            @if (usedSpecs > 0)
            {
                <span class="badge bg-danger" style="font-size: 14px;">@usedSpecs thông số</span>
                <div class="alert alert-danger mt-2">
                    <i class="fas fa-ban"></i>
                    <strong>Không thể xóa!</strong> Danh mục này đang được sử dụng trong @usedSpecs thông số sản phẩm.
                </div>
            }
            else
            {
                <span class="badge bg-success" style="font-size: 14px;">0 thông số</span>
                <small class="text-muted d-block mt-1">
                    <i class="fas fa-check-circle text-success"></i> Có thể xóa an toàn
                </small>
            }
        </div>
    </div>
</div>

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

    <div class="row">
        <div class="offset-md-2 col-md-10">
            @{
                var usedCount = Model.ProductSpecifications != null
                    ? Model.ProductSpecifications.Where(ps => ps.ProductID != 0).Count()
                    : 0;
            }
            @if (usedCount == 0)
            {
                <input type="submit" value="Xác nhận xóa" class="btn btn-danger" onclick="return confirm('Bạn có chắc chắn muốn xóa danh mục này không?');" />
            }
            else
            {
                <button type="button" class="btn btn-danger" disabled title="Không thể xóa do đang được sử dụng">
                    <i class="fas fa-lock"></i> Không thể xóa
                </button>
            }
            @Html.ActionLink("Quay lại danh sách", "Index", null, new { @class = "btn btn-primary" })
        </div>
    </div>
}