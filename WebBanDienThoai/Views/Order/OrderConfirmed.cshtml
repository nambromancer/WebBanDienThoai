@model WebBanDienThoai.Models.Order

@{
    ViewBag.Title = "Đặt hàng thành công";
    Layout = "~/Views/Shared/_Layout.cshtml";

    // Tính toán phí ship và tổng sản phẩm
    decimal productTotal = 0;
    if (Model.OrderDetails != null && Model.OrderDetails.Any())
    {
        productTotal = Model.OrderDetails.Sum(od => od.TotalPrice.HasValue ? od.TotalPrice.Value : (od.UnitPrice * od.Quantity));
    }

    decimal shippingFee = 0;
    if (Model.DeliveryMethod == "Giao hàng nhanh")
    {
        shippingFee = 30000;
    }
}

@section Styles {
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        .order-confirmed-container {
            max-width: 800px;
            margin: 50px auto;
            padding: 40px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            text-align: center;
        }

        .success-icon {
            font-size: 80px;
            color: #27ae60;
            margin-bottom: 20px;
            animation: scaleIn 0.5s ease;
        }

        @@keyframes scaleIn {
            from {
                transform: scale(0);
            }

            to {
                transform: scale(1);
            }
        }

        .order-confirmed-title {
            font-size: 32px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .order-confirmed-message {
            font-size: 18px;
            color: #7f8c8d;
            margin-bottom: 30px;
        }

        .order-info-box {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            margin: 30px 0;
            text-align: left;
        }

        .order-info-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #dee2e6;
        }

            .order-info-row:last-child {
                border-bottom: none;
            }

        .order-info-label {
            font-weight: 600;
            color: #495057;
        }

        .order-info-value {
            color: #2c3e50;
        }

        .order-total {
            font-size: 20px;
            color: #e74c3c;
            font-weight: 700;
        }

        .shipping-fee {
            color: #27ae60;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn-primary-custom {
            padding: 14px 30px;
            background: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

            .btn-primary-custom:hover {
                background: #2980b9;
                transform: translateY(-2px);
                text-decoration: none;
                color: white;
            }

        .btn-secondary-custom {
            padding: 14px 30px;
            background: #95a5a6;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

            .btn-secondary-custom:hover {
                background: #7f8c8d;
                transform: translateY(-2px);
                text-decoration: none;
                color: white;
            }
    </style>
}

<div class="order-confirmed-container">
    <i class="fas fa-check-circle success-icon"></i>
    <h1 class="order-confirmed-title">Đặt hàng thành công!</h1>
    <p class="order-confirmed-message">
        Cảm ơn bạn đã đặt hàng. Chúng tôi sẽ liên hệ với bạn sớm nhất.
    </p>

    <div class="order-info-box">
        <div class="order-info-row">
            <span class="order-info-label">Mã đơn hàng:</span>
            <span class="order-info-value">#@Model.OrderID</span>
        </div>
        <div class="order-info-row">
            <span class="order-info-label">Ngày đặt hàng:</span>
            <span class="order-info-value">
                @if (Model.OrderDate.HasValue)
                {
                    @Model.OrderDate.Value.ToString("dd/MM/yyyy HH:mm")
                }
                else
                {
                    <text>N/A</text>
                }
            </span>
        </div>
        <div class="order-info-row">
            <span class="order-info-label">Tên khách hàng:</span>
            <span class="order-info-value">@Model.Customer.CustomerName</span>
        </div>
        <div class="order-info-row">
            <span class="order-info-label">Số điện thoại:</span>
            <span class="order-info-value">@Model.Customer.PhoneNumber</span>
        </div>
        <div class="order-info-row">
            <span class="order-info-label">Địa chỉ giao hàng:</span>
            <span class="order-info-value">@Model.AddressDelivery</span>
        </div>
        <div class="order-info-row">
            <span class="order-info-label">Phương thức giao hàng:</span>
            <span class="order-info-value">@Model.DeliveryMethod</span>
        </div>
        <div class="order-info-row">
            <span class="order-info-label">Phương thức thanh toán:</span>
            <span class="order-info-value">@Model.PaymentMethod</span>
        </div>
        <div class="order-info-row">
            <span class="order-info-label">Tiền sản phẩm:</span>
            <span class="order-info-value">@String.Format("{0:N0} ₫", productTotal)</span>
        </div>
        <div class="order-info-row">
            <span class="order-info-label">Phí vận chuyển:</span>
            <span class="order-info-value shipping-fee">
                @if (shippingFee > 0)
                {
                    @String.Format("{0:N0} ₫", shippingFee)
                }
                else
                {
                    <text>Miễn phí</text>
                }
            </span>
        </div>
        <div class="order-info-row">
            <span class="order-info-label">Tổng tiền:</span>
            <span class="order-total">@String.Format("{0:N0} ₫", Model.TotalAmount)</span>
        </div>
    </div>

    <div class="action-buttons">
        <a href="@Url.Action("Index", "Home")" class="btn-secondary-custom">
            <i class="fas fa-home"></i> Về trang chủ
        </a>
        <a href="@Url.Action("PurchaseHistory", "Account")" class="btn-primary-custom">
            <i class="fas fa-history"></i> Xem lịch sử đơn hàng
        </a>
    </div>
</div>